<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–∫–∞–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 15px; font-family: system-ui, -apple-system, sans-serif; }
        .card { border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .item-block { background: #fff; border: 1px solid #eee; padding: 12px; border-radius: 10px; margin-bottom: 10px; position: relative; }
        .remove-btn { position: absolute; top: 5px; right: 8px; color: #ff4d4d; cursor: pointer; border: none; background: none; font-size: 1.2rem; }
        .total-footer { background: #1a1a1a; color: white; padding: 20px; border-radius: 12px; position: sticky; bottom: 10px; z-index: 100; }
        #paymentScreen { display: none; }
        .badge-rent { background: #007bff; font-size: 0.7rem; }
        .badge-sale { background: #28a745; font-size: 0.7rem; }
        /* –°–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .spinner-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 200; justify-content: center; align-items: center; flex-direction: column; }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingSpinner" class="spinner-overlay">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
        <div class="mt-3 fw-bold">–û—Ñ–æ—Ä–º–ª—è–µ–º –∑–∞–∫–∞–∑...</div>
    </div>

    <div class="container" style="max-width: 550px;">
        <div id="orderScreen">
            <div class="card p-3 mb-3">
                <h4 class="text-center fw-bold mb-3">üîß –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥—ã</h4>
                
                <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö: –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ -->
                <div class="d-flex justify-content-between align-items-center mb-3 p-3 bg-white border rounded shadow-sm">
                    <div style="padding-right: 10px;">
                        <label class="fw-bold d-block mb-0" for="extensionMode" style="cursor: pointer;">üîÑ –≠—Ç–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥—ã</label>
                        <div class="small text-muted mt-1" style="font-size: 0.8rem; line-height: 1.2;">–í–∫–ª—é—á–∏—Ç–µ, –µ—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–∂–µ —É –≤–∞—Å.</div>
                    </div>
                    <div class="form-check form-switch m-0 p-0">
                        <input class="form-check-input m-0" type="checkbox" id="extensionMode" onchange="toggleExtensionMode()" style="cursor: pointer; transform: scale(1.3);">
                    </div>
                </div>
                <!-- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê -->

                <div class="mb-3">
                    <input type="text" id="clientName" class="form-control mb-2" placeholder="–§–ò–û / –ö–æ–º–ø–∞–Ω–∏—è" required>
                    <input type="tel" id="clientPhone" class="form-control mb-2" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω +79...." required>
                    <input type="email" id="clientEmail" class="form-control" placeholder="–í–∞—à Email" required>
                </div>

                <datalist id="toolsData"></datalist>
                <datalist id="consData"></datalist>

                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="small fw-bold text-muted">–í–´–ë–ï–†–ò–¢–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢</span>
                    <div>
                        <button class="btn btn-sm btn-primary" onclick="addItem('tool')">+ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</button>
                        <button class="btn btn-sm btn-success" onclick="addItem('cons')">+ –†–∞—Å—Ö–æ–¥–Ω–∏–∫</button>
                    </div>
                </div>

                <div id="itemsContainer"></div>

                <!-- –ë–õ–û–ö: –û–ë–©–ò–ô –°–†–û–ö –ê–†–ï–ù–î–´ -->
                <div class="mt-4 p-3 bg-light rounded border">
                    <label class="fw-bold d-block mb-2">üìÖ –ù–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –±–µ—Ä–µ—Ç–µ?</label>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-white border shadow-sm fw-bold" onclick="changeGlobalDays(-1)" style="width: 45px; height: 45px;">-</button>
                        <input type="number" id="globalDays" class="form-control mx-2 text-center fw-bold fs-5" value="1" min="1" readonly style="width: 80px; background: white;">
                        <button class="btn btn-white border shadow-sm fw-bold" onclick="changeGlobalDays(1)" style="width: 45px; height: 45px;">+</button>
                        <span class="ms-2 fs-6 text-muted">—Å—É—Ç–æ–∫</span>
                    </div>
                </div>

            </div>

            <div class="total-footer shadow">
                <div class="d-flex justify-content-between small opacity-75"><span>–ê—Ä–µ–Ω–¥–∞/–¢–æ–≤–∞—Ä—ã:</span> <span id="sumItems">0</span> ‚ÇΩ</div>
                <div class="d-flex justify-content-between small opacity-75"><span>–ó–∞–ª–æ–≥ (–≤–æ–∑–≤—Ä–∞—Ç–Ω—ã–π):</span> <span id="sumDeposit">0</span> ‚ÇΩ</div>
                <hr class="my-2 opacity-25">
                <div class="d-flex justify-content-between h4 mb-0"><strong>–ò–¢–û–ì–û:</strong> <strong class="text-warning"><span id="sumTotal">0</span> ‚ÇΩ</strong></div>
                <button class="btn btn-primary w-100 btn-lg mt-3 fw-bold" onclick="submitOrder()">–ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨ –ò –û–ü–õ–ê–¢–ò–¢–¨</button>
            </div>
        </div>

        <div id="paymentScreen" class="card p-4 text-center">
            <div class="display-4 text-success mb-3">‚úì</div>
            <h5>–ó–∞–∫–∞–∑ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω</h5>
            <p class="text-muted mb-1">–ö –æ–ø–ª–∞—Ç–µ —Å —É—á–µ—Ç–æ–º –∑–∞–ª–æ–≥–∞:</p>
            <h2 id="payAmount" class="text-primary mb-2">0 ‚ÇΩ</h2>
            
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ª–æ–≥–∞ –æ—Ç–¥–µ–ª—å–Ω–æ -->
            <div class="bg-light p-2 rounded mb-4 border">
                <small class="text-muted d-block">–í —Ç–æ–º —á–∏—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–Ω—ã–π –∑–∞–ª–æ–≥:</small>
                <strong class="fs-5 text-dark"><span id="payDeposit">0</span> ‚ÇΩ</strong>
            </div>

            <p class="small text-muted">–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–¥—Ç—è–Ω—É–ª–∏—Å—å, –≤–≤–µ–¥–∏—Ç–µ –∏—Ö –≤—Ä—É—á–Ω—É—é –≤ —Ñ–æ—Ä–º–µ –æ–ø–ª–∞—Ç—ã.</p>
            <a href="#" id="payButton" target="_blank" class="btn btn-success btn-lg w-100 fw-bold">–û–ü–õ–ê–¢–ò–¢–¨ –ß–ï–†–ï–ó –¢–û–ß–ö–ê –ë–ê–ù–ö</a>
            <button class="btn btn-link btn-sm mt-3 text-muted" onclick="location.reload()">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑—É</button>
        </div>
    </div>

    <script>
        // ================= –ù–ê–°–¢–†–û–ô–ö–ò =================
        const TOCHKA_BASE_URL = "https://checkout.tochka.com/7d0c1c1b-56ed-4df2-aa19-df7ce0568ae0";
        const MAKE_WEBHOOK_URL = "https://hook.eu1.make.com/a82jcgdj7u88frnb6bm0xqukvlxxw4og"; 
        // =============================================

        const CATALOG = {
            tools: [
                { name: "–õ–µ–Ω—Ç–æ—à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –ó—É–±—Ä –ó–õ–®–ú-76-950", price: 500, deposit: 4000 },
                { name: "–ü–∞—è–ª—å–Ω–∏–∫ –ø–æ–ª–∏–ø—Ä–æ–ø–∏–ª–µ–Ω–∞ black gear", price: 600, deposit: 3000 },
                { name: "–£–®–ú 125 max pro 680W", price: 350, deposit: 3000 },
                { name: "–î—Ä–µ–ª—å —Ç–∏—Ö–æ—Ö–æ–¥–Ω–∞—è —Å –º–∏–∫—Ä–æ—É–¥–∞—Ä–æ–º AEG DB1500-2XE", price: 2500, deposit: 15000 },
                { name: "–†—É–±–∞–Ω–æ–∫ –∏–Ω—Ç–µ—Ä—Å–∫–æ–ª P-110/1100M", price: 600, deposit: 5000 },
                { name: "–§—Ä–µ–∑–µ—Ä RYOBI RRT 1600", price: 800, deposit: 7000 },
                { name: "–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä Sturm RH25206PM", price: 1000, deposit: 7000 },
                { name: "–ü–Ω–µ–≤–º–æ–ø–∏—Å—Ç–æ–ª–µ—Ç toua GSN 50", price: 1000, deposit: 20000 },
                { name: "–§–µ–Ω —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Å–∫–æ–ª —Ñ—ç-2000", price: 350, deposit: 2500 },
                { name: "–ü–ª–∞–∑–º–æ—Ä–µ–∑ –ø—Ç–∫ RILON CUT 60 C", price: 2000, deposit: 30000 },
                { name: "–ì–∞–∑–æ–≤—ã–π –≥–≤–æ–∑–¥–µ–∑–∞–±–∏–≤–Ω–æ–π –ø–∏—Å—Ç–æ–ª–µ—Ç toua GFN3490CH-C", price: 1000, deposit: 25000 },
                { name: "–ë–µ—Ç–æ–Ω–æ–º–µ—à–∞–ª–∫–∞ 63 –ª –ó–µ–º–ª—è–∫ –ë–°–≠-63", price: 1000, deposit: 8000 },
                { name: "–ö–ª—É–ø–ø sq30-2c", price: 1500, deposit: 15000 },
                { name: "–£–®–ú 230 metabo W2200-230", price: 800, deposit: 7000 },
                { name: "–¶–∏–∫–ª–µ–≤–æ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ –ú–∏—Å–æ–Ω –°–û-206", price: 1500, deposit: 40000 },
                { name: "–û—Ç–±–æ–π–Ω—ã–π –º–æ–ª–æ—Ç–æ–∫ Favorit", price: 2000, deposit: 15000 },
                { name: "–ë–µ–∑–≤–æ–∑–¥—É—à–Ω—ã–π –∫—Ä–∞—Å–∫–æ–ø—É–ª—å—Ç SCHTAER Mars 20", price: 1500, deposit: 35000 },
                { name: "–≠–ª–µ–∫—Ç—Ä–æ–ø—É—à–∫–∞ Stand YXC-03RE", price: 350, deposit: 3000 },
                { name: "–î–∏–∑–µ–ª—å–Ω–∞—è –ø—É—à–∫–∞ Ganta –¢–ü–î-55", price: 2000, deposit: 15000 },
                { name: "–®—Ç—Ä–æ–±–æ—Ä–µ–∑ Makitta SG 150", price: 1500, deposit: 25000 },
                { name: "–®—Ç—Ä–æ–±–æ—Ä–µ–∑ Bosch GNF 35 CA", price: 1500, deposit: 25000 },
                { name: "–ü—ã–ª–µ—Å–æ—Å Bosch GAS 20 L SFC", price: 1000, deposit: 10000 },
                { name: "–ü—ã–ª–µ—Å–æ—Å Makitta 440", price: 1000, deposit: 10000 },
                { name: "–í—ã—à–∫–∞ —Ç—É—Ä–∞ 1,2*2,0*7,6", price: 1000, deposit: 15000 },
                { name: "–†–µ—Ö–∞–æ –ü—Ä–µ—Å—Å-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Tim FT1240B-QC", price: 600, deposit: 10000 },
                { name: "–ö–∞—Ç–æ–∫ –¥–ª—è –≥–∞–∑–æ–Ω–∞ 50 –ª", price: 500, deposit: 5000 },
                { name: "–ñ–∏—Ä–∞—Ñ Schtaer 3000F3", price: 1000, deposit: 15000 },
                { name: "–ì–∞–∑–æ–Ω–æ–∫–æ—Å–∏–ª–∫–∞ –±–µ–Ω–∑ —Å–∞–º–æ—Ö–æ–¥–Ω–∞—è ECO MX196", price: 2000, deposit: 20000 },
                { name: "–¢–µ–ø–ª–æ–≤–∏–∑–æ—Ä HTI HT-19", price: 1500, deposit: 25000 },
                { name: "–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä Makitta 2470", price: 600, deposit: 6000 },
                { name: "–®—É—Ä—É–ø–æ–≤–µ—Ä—Ç Bosch GSB120-Li", price: 600, deposit: 5000 },
                { name: "–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä 100 –ª Inforce CE100", price: 1500, deposit: 25000 },
                { name: "–°–≤–∞—Ä–æ—á–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç –ø–æ–ª—É–∞–≤—Ç–æ–º–∞—Ç —Å–≤–∞—Ä–æ–≥ Real MIG 200", price: 1500, deposit: 20000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å Master DH92 (92 –ª/—Å—É—Ç)", price: 1000, deposit: 40000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å Master DH62 (62 –ª/—Å—É—Ç)", price: 800, deposit: 30000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å Wilms KT 800 (77 –ª/—Å—É—Ç)", price: 900, deposit: 35000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å dehu-70l", price: 900, deposit: 30000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å master DH732", price: 800, deposit: 25000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å master DH752", price: 800, deposit: 25000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å Dantherm CDT 90", price: 1000, deposit: 50000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å ASPRO-DRY60", price: 800, deposit: 25000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å Dehumidifier DB50", price: 800, deposit: 20000 },
                { name: "–û—Å—É—à–∏—Ç–µ–ª—å Danvex DEN 500i", price: 800, deposit: 25000 },
                { name: "–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä –ú–∞–∫–∏—Ç–∞ 5001—Å", price: 2000, deposit: 25000 },
                { name: "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä CHAMPION GG7501E-3", price: 1500, deposit: 35000 },
                { name: "–ú–æ—Ç–æ–±—É—Ä CHAMPION AG252", price: 1000, deposit: 12000 },
                { name: "–ú–æ—Ç–æ–ø–æ–º–ø–∞ FUBAG 950T", price: 800, deposit: 10000 },
                { name: "–ü–ª–∏—Ç–∫–æ—Ä–µ–∑ –ó—É–±—Ä", price: 1000, deposit: 10000 },
                { name: "–°–≤–∞—Ä–æ—á–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç Foxweld VARTEG 230", price: 500, deposit: 5000 },
                { name: "–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä Aurora CYCLON-75 TURBO", price: 1000, deposit: 20000 },
                { name: "–ñ–µ–ª–æ–±–æ–Ω–∞–∫–∞—Ç–Ω—ã–π —Å—Ç–∞–Ω–æ–∫ VOLL V-Groover 6", price: 3000, deposit: 50000 },
                { name: "–ò–∑–º–µ–ª—å—á–∏—Ç–µ–ª—å –≤–µ—Ç–æ–∫ GBK 150", price: 7000, deposit: 100000 },
                { name: "–ò–∑–º–µ–ª—å—á–∏—Ç–µ–ª—å –ø–Ω–µ–π SGR1500–µ", price: 6000, deposit: 150000 },
                { name: "–¢–æ—Ä—Ü–æ–≤–∞—è –ø–∏–ª–∞ —Å –ø—Ä–æ—Ç—è–∂–∫–æ–π –∑—É–±—Ä –ó–ü–¢-305", price: 2000, deposit: 20000 },
                { name: "–ü—ã–ª–µ—Å–æ—Å –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π Linolit 322E", price: 2000, deposit: 40000 },
                { name: "–ü–ª–∏—Ç–∫–æ—Ä–µ–∑ Wandeli ZX-1200", price: 2000, deposit: 50000 },
                { name: "–í–∏–±—Ä–æ—Ä–µ–π–∫–∞ 2,5 –º VEKTOR VSJ-2.5", price: 2000, deposit: 15000 },
                { name: "–ü–ª–∞–∑–º–æ—Ä–µ–∑ –ê–≤—Ä–æ—Ä–∞ –¥–∂–µ—Ç 40", price: 2500, deposit: 30000 },
                { name: "–í–∏–±—Ä–∞—Ç–æ—Ä –¥–ª—è –±–µ—Ç–æ–Ω–∞ Oli EWO 38", price: 2000, deposit: 25000 },
                { name: "–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä MASTER DF 20 P", price: 800, deposit: 10000 },
                { name: "–ì–∞–∑–æ–≤–∞—è –ø—É—à–∫–∞ Gigant GH30FD", price: 900, deposit: 7000 },
                { name: "–®–≤–æ–Ω–∞—Ä–µ–∑—á–∏–∫ –°–ª–∏–ø—Å—Ç–æ—É–Ω CS146", price: 2500, deposit: 40000 },
                { name: "–†–µ–∑—á–∏–∫ –∫—Ä–æ–≤–ª–∏ –°–ª–∏–ø—Å—Ç–æ—É–Ω CS149", price: 2500, deposit: 40000 },
                { name: "–í–∏–±—Ä–æ–ø–ª–∏—Ç–∞ 300 –∫–≥ VS-309", price: 4000, deposit: 80000 },
                { name: "–®–≤–æ–Ω–∞—Ä–µ–∑—á–∏–∫ –Ω–∞ 900 –º–º CS3213", price: 4000, deposit: 150000 },
                { name: "–®–ª–∏—Ñ–º–∞—à–∏–Ω–∞ –ø–æ –±–µ—Ç–æ–Ω—É GM_122", price: 2500, deposit: 50000 },
                { name: "–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä SDS+ BH-2100N", price: 800, deposit: 6000 },
                { name: "–®—Ç—Ä–æ–±–æ—Ä–µ–∑ –∑—É–±—Ä 230 –º–º", price: 2000, deposit: 15000 },
                { name: "–î–µ—Ç–µ–∫—Ç–æ—Ä –ø—Ä–æ–≤–æ–¥–∫–∏ Bosch gms120", price: 800, deposit: 7000 },
                { name: "–ò–∑–º–µ—Ä–∏—Ç–µ–ª—å –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ Testo", price: 800, deposit: 15000 },
                { name: "–ú–æ–π–∫–∞ Karcher K7 Compact", price: 1300, deposit: 25000 },
                { name: "–í–∏–±—Ä–æ–ø–ª–∏—Ç–∞ 100 –∫–≥ Zitrek", price: 1500, deposit: 20000 },
                { name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–ª–º–∞–∑–Ω–æ–≥–æ –±—É—Ä–µ–Ω–∏—è –°–∞—Ç—É—Ä–Ω", price: 2000, deposit: 40000 },
                { name: "–í–∏–±—Ä–æ—Ç—Ä–∞–º–±–æ–≤–∫–∞ Gigant Honda dvt75", price: 2000, deposit: 60000 },
                { name: "–®–ª–∏—Ñ–º–∞—à–∏–Ω–∞ –ø–æ –±–µ—Ç–æ–Ω—É GM_245/7.5", price: 3800, deposit: 100000 },
                { name: "–°–≤–∞–µ–∫—Ä—É—Ç REBIR AIE-1206", price: 2000, deposit: 20000 },
                { name: "–°–Ω–µ–≥–æ—É–±–æ—Ä—â–∏–∫ Huter SGC 8100", price: 2500, deposit: 40000 },
                { name: "–¢–µ—Ä–º–æ–º–∞—Ç—ã (–ø—Ä–æ–≥—Ä–µ–≤ –±–µ—Ç–æ–Ω–∞)", price: 500, deposit: 3000 },
                { name: "–ó–∞—Ç–∏—Ä–æ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ (–í–µ—Ä—Ç–æ–ª–µ—Ç)", price: 2000, deposit: 30000 },
                { name: "–°—Ç–µ–Ω–æ—Ä–µ–∑ Kenrus DC 425", price: 2000, deposit: 60000 },
                { name: "–í–∏–±—Ä–æ–ø–ª–∏—Ç–∞ 215 –∫–≥ Masalta MS250", price: 2500, deposit: 60000 }
            ],
            consumables: [
                { name: "–®–Ω–µ–∫ 200–º–º + —É–¥–ª–∏–Ω–∏—Ç–µ–ª—å", price: 500 },
                { name: "–î–∏—Å–∫ –∞–ª–º–∞–∑–Ω—ã–π 230–º–º", price: 800 },
                { name: "–ü–µ—Ä—á–∞—Ç–∫–∏ —Ä–∞–±–æ—á–∏–µ", price: 100 },
                { name: "–ú–µ—à–æ–∫ –¥–ª—è –ø—ã–ª–µ—Å–æ—Å–∞", price: 350 }
            ]
        };

        function initLists() {
            document.getElementById('toolsData').innerHTML = CATALOG.tools.map(t => `<option value="${t.name}">`).join('');
            document.getElementById('consData').innerHTML = CATALOG.consumables.map(c => `<option value="${c.name}">`).join('');
        }

        // –§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—â–µ–≥–æ —Å—Ä–æ–∫–∞
        function changeGlobalDays(delta) {
            const input = document.getElementById('globalDays');
            let val = parseInt(input.value) || 1;
            val += delta;
            if (val < 1) val = 1;
            input.value = val;
            calc(); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É —Å—Ä–∞–∑—É
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è
        function toggleExtensionMode() {
            calc();
        }

        function addItem(type) {
            const container = document.getElementById('itemsContainer');
            const div = document.createElement('div');
            div.className = `item-block ${type}-item`;
            
            div.innerHTML = `
                <button class="remove-btn" onclick="this.parentElement.remove(); calc()">&times;</button>
                <span class="badge ${type==='tool'?'badge-rent':'badge-sale'} mb-2">${type==='tool'?'–ê–†–ï–ù–î–ê':'–¢–û–í–ê–†'}</span>
                <input type="text" class="form-control mb-2 name-input" list="${type==='tool'?'toolsData':'consData'}" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å..." oninput="calc()">
                <div class="row g-2">
                    <div class="col-12">
                        <label class="small text-muted">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="number" class="form-control qty" value="1" min="1" oninput="calc()">
                    </div>
                </div>`;
            container.prepend(div);
        }

        function calc() {
            let itemsSum = 0; 
            let depositSum = 0;
            const globalDays = parseInt(document.getElementById('globalDays').value) || 1;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Ä–µ–∂–∏–º –ø—Ä–æ–¥–ª–µ–Ω–∏—è
            const isExtension = document.getElementById('extensionMode').checked;

            document.querySelectorAll('.item-block').forEach(el => {
                const name = el.querySelector('.name-input').value;
                const qty = parseInt(el.querySelector('.qty').value) || 0;
                
                if (el.classList.contains('tool-item')) {
                    const tool = CATALOG.tools.find(t => t.name === name);
                    if (tool) { 
                        itemsSum += tool.price * qty * globalDays; 
                        // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, –∑–∞–ª–æ–≥ –Ω–µ —Å—á–∏—Ç–∞–µ–º
                        if (!isExtension) {
                            depositSum += tool.deposit * qty; 
                        }
                    }
                } else {
                    const cons = CATALOG.consumables.find(c => c.name === name);
                    if (cons) itemsSum += cons.price * qty;
                }
            });

            document.getElementById('sumItems').innerText = itemsSum.toLocaleString();
            document.getElementById('sumDeposit').innerText = depositSum.toLocaleString();
            document.getElementById('sumTotal').innerText = (itemsSum + depositSum).toLocaleString();
            
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–ª–æ–≥–∞ –ø—Ä–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏
            const depositEl = document.getElementById('sumDeposit');
            if (isExtension) {
                depositEl.style.textDecoration = "line-through";
                depositEl.style.opacity = "0.5";
            } else {
                depositEl.style.textDecoration = "none";
                depositEl.style.opacity = "1";
            }
        }

        async function submitOrder() {
            const name = document.getElementById('clientName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            const email = document.getElementById('clientEmail').value.trim();
            
            if (!name || !phone || !email) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û, –¢–µ–ª–µ—Ñ–æ–Ω –∏ Email');
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Email');
            const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,15}$/;
            if (!phoneRegex.test(phone)) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');

            document.getElementById('loadingSpinner').style.display = 'flex';

            const globalDays = parseInt(document.getElementById('globalDays').value) || 1;
            const isExtension = document.getElementById('extensionMode').checked;
            
            let itemsList = "";

            document.querySelectorAll('.item-block').forEach(el => {
                const itemName = el.querySelector('.name-input').value;
                const qty = el.querySelector('.qty').value;
                let details = `${itemName} (x${qty})`;
                
                if (el.classList.contains('tool-item')) {
                    details += ` –Ω–∞ ${globalDays} –¥–Ω.`;
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–º–µ—Ç–∫—É –æ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏ –≤ —Ç–µ–∫—Å—Ç —Ç–æ–≤–∞—Ä–∞
                if (isExtension) {
                    details = "üîÑ –ü–†–û–î–õ–ï–ù–ò–ï: " + details;
                }

                itemsList += `‚Ä¢ ${details}\n`;
            });

            if (itemsList === "") itemsList = "–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤";

            const totalRaw = document.getElementById('sumTotal').innerText.replace(/\s/g, '');
            const depositRaw = document.getElementById('sumDeposit').innerText.replace(/\s/g, ''); 

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Make
            if (MAKE_WEBHOOK_URL && MAKE_WEBHOOK_URL.includes('hook')) {
                try {
                    await fetch(MAKE_WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: name,
                            phone: phone,
                            email: email,
                            items: itemsList,
                            total: totalRaw,
                            days: globalDays,
                            deposit: depositRaw 
                        })
                    });
                } catch (e) {
                    console.log("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Make", e);
                }
            }

            const paymentUrl = `${TOCHKA_BASE_URL}?sum=${totalRaw}&fio=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}&email=${encodeURIComponent(email)}`;
            
            document.getElementById('payButton').href = paymentUrl;
            document.getElementById('payAmount').innerText = document.getElementById('sumTotal').innerText + ' ‚ÇΩ';
            
            document.getElementById('payDeposit').innerText = document.getElementById('sumDeposit').innerText;

            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('orderScreen').style.display = 'none';
            document.getElementById('paymentScreen').style.display = 'block';
        }

        initLists();
        addItem('tool');
    </script>
</body>
</html>
